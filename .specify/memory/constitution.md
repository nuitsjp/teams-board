<!--
=== Sync Impact Report ===
Version change: (新規) → 1.0.0
Modified principles: なし（初回制定）
Added sections:
  - 原則 I: コード品質
  - 原則 II: テスト基準
  - 原則 III: UX一貫性
  - 原則 IV: パフォーマンス要件
  - セクション: セキュリティ・運用制約
  - セクション: 開発ワークフロー
  - ガバナンス
Removed sections: なし
Templates requiring updates:
  - .specify/templates/plan-template.md ✅ 整合確認済（Constitution Check セクション対応可）
  - .specify/templates/spec-template.md ✅ 整合確認済（要件・成功基準セクション対応可）
  - .specify/templates/tasks-template.md ✅ 整合確認済（Phase構成・テストタスク対応可）
Follow-up TODOs: なし
===
-->

# study-log Constitution

## Core Principles

### I. コード品質

すべてのコードは以下の基準を満たさなければならない（MUST）。

- **可読性**: 変数名・関数名は意図を明確に表現する英語名とし、
  コメントおよびドキュメントは日本語で記述する
- **単一責任**: 各モジュール・関数は1つの責務のみを持つ。
  1ファイルに複数の無関係な責務を混在させてはならない
- **DRY（Don't Repeat Yourself）**: 同一ロジックの重複は
  3箇所以上で発生した時点で共通化を検討する。
  ただし早すぎる抽象化（YAGNI違反）は避ける
- **型安全性**: TypeScript を使用する場合、`any` 型の使用は
  正当な理由がない限り禁止する。型定義を活用し、
  コンパイル時にエラーを検出する
- **秘密情報の分離**: 接続文字列・APIキー・秘密鍵等を
  ソースコードにハードコードしてはならない（MUST NOT）。
  環境変数または Azure Key Vault 経由で参照する

### II. テスト基準

テストはソフトウェア品質の最終防衛線であり、以下を遵守する。

- **テストファースト推奨**: 新機能追加時はテストを先に書くことを
  推奨する（SHOULD）。バグ修正時は再現テストを先に書くことを
  必須とする（MUST）
- **テストカバレッジ**: ビジネスロジック（サービス層）は
  単体テストでカバーする。API エンドポイントは
  結合テストでカバーする
- **テスト分類**:
  - 単体テスト: 外部依存なし、高速実行（1テスト100ms以内）
  - 結合テスト: API経路の疎通確認、DB接続を含む
  - E2Eテスト: ブラウザ経由の認証・認可フロー検証
    （最小構成の合格基準に対応）
- **テスト命名**: テスト名は「何を」「どの条件で」「どうなるか」を
  明示する（例: `test_GetRoles_OrgMember_ReturnsRole`）
- **テストデータ**: テスト用データはテスト内で生成・破棄する。
  共有状態に依存するテストは禁止する（MUST NOT）

### III. UX一貫性

ユーザーに提供するインターフェースは一貫した体験を保証する。

- **エラーメッセージ**: すべてのエラーレスポンスは統一された
  JSON構造（`{ "error": { "code": "...", "message": "..." } }`）
  で返却する（MUST）
- **認証・認可フロー**: 未認証ユーザーにはログイン画面を提示し、
  認証済みだが権限不足のユーザーには明確な権限不足メッセージを
  返す。無言のリダイレクトやブランクページは禁止する
- **APIレスポンス形式**: すべてのAPIは JSON を返却する。
  成功時は適切なHTTPステータスコード（200/201/204）を使用し、
  エラー時は4xx/5xxと上記エラー構造を返す
- **ローディング状態**: API呼び出し中はフロントエンドで
  ローディング状態を表示する（SHOULD）。
  無反応な画面を放置してはならない
- **日本語対応**: ユーザー向けメッセージ（エラー含む）は
  日本語で表示する

### IV. パフォーマンス要件

本プロジェクトは社内利用のWebアプリであり、
以下のパフォーマンス基準を設定する。

- **APIレスポンス時間**: 通常のCRUD操作は p95 で 500ms 以内に
  応答する（MUST）。Cold Start を含む初回アクセスは
  3秒以内とする（SHOULD）
- **フロントエンド初期表示**: 静的アセットの初回ロードは
  3秒以内（3G回線を除く）とする（SHOULD）
- **データベースクエリ**: 単一テーブルへの基本クエリは
  100ms 以内に完了する（MUST）。
  結合クエリは 300ms 以内を目標とする
- **バンドルサイズ**: フロントエンドの初期バンドルは
  500KB（gzip後）以内に抑える（SHOULD）
- **Azure Functions**: Cold Start の影響を最小化するため、
  依存パッケージ数を必要最小限に保つ（MUST）

## セキュリティ・運用制約

本プロジェクト固有のセキュリティおよび運用に関する制約を定める。

- **秘密情報管理**: すべての秘密情報は Azure Key Vault に
  格納する（MUST）。アプリ設定への平文保管は禁止する
- **認可境界**: GitHub Organization メンバーシップによる
  アクセス制御を基本とし、rolesSource でサーバ側判定を行う
- **ブラウザ側制約**: ブラウザには DB 資格情報や
  共有キーを保持しない（MUST NOT）
- **DB接続**: SQL Database への接続は API（Functions）経由のみ
  とし、フロントエンドからの直接接続は禁止する
- **依存パッケージ**: 新規パッケージの追加時は、
  メンテナンス状況・ライセンス・セキュリティを確認する（MUST）

## 開発ワークフロー

コード変更からデプロイまでのワークフローを定める。

- **ブランチ戦略**: 機能開発は feature ブランチで行い、
  main ブランチへの直接コミットは禁止する（MUST NOT）
- **コミットメッセージ**: Conventional Commits 形式
  （`feat:`, `fix:`, `docs:` 等）に準拠する（MUST）
- **コードレビュー**: main へのマージ前にレビューを実施する
  （SHOULD）。セキュリティに関わる変更は必須とする（MUST）
- **CI/CD**: GitHub Actions によるデプロイパイプラインを使用し、
  テスト通過をマージ条件とする（SHOULD）
- **環境管理**: SWA はステージング環境なしで運用し、
  本番URLを初期構築時に確定する

## Governance

本コンスティテューションはプロジェクトの最上位規範であり、
他のすべてのプラクティスに優先する。

- **改定手続き**: 改定は文書化し、変更理由・影響範囲を
  明記したうえで実施する。改定時は Sync Impact Report を
  更新する（MUST）
- **バージョニング**: セマンティックバージョニングに準拠する
  - MAJOR: 原則の削除・再定義（後方互換性なし）
  - MINOR: 原則の追加・大幅な拡張
  - PATCH: 文言修正・誤字修正・非意味的な改善
- **コンプライアンス確認**: 各PR/レビュー時に本コンスティテューション
  への準拠を確認する。Implementation Plan の Constitution Check
  セクションで原則への適合を検証する
- **ランタイムガイダンス**: 開発時の具体的な手順や設定は
  CLAUDE.md およびプロジェクトドキュメントを参照する

**Version**: 1.0.0 | **Ratified**: 2026-02-01 | **Last Amended**: 2026-02-01
