#!/bin/bash
# ダミーデータ生成スクリプト
# ダッシュボード検証用のindex.jsonと個別アイテムJSONを一括生成する
set -euo pipefail

# 出力先ディレクトリ
SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
DATA_DIR="${SCRIPT_DIR}/../frontend/dashboard/public/data"
ITEMS_DIR="${DATA_DIR}/items"

# ディレクトリ作成
mkdir -p "${ITEMS_DIR}"

# タイムスタンプ（ISO 8601）
UPDATED_AT="$(date -u +%Y-%m-%dT%H:%M:%S+09:00)"

echo "ダミーデータを生成しています..."
echo "出力先: ${DATA_DIR}"

# --- item-001: 月次売上レポート ---
cat > "${ITEMS_DIR}/item-001.json" << 'EOF'
{
  "id": "item-001",
  "title": "月次売上レポート",
  "data": {
    "期間": "2026年1月",
    "売上合計": 1500000,
    "件数": 42,
    "前月比": "+8.5%",
    "内訳": [
      { "カテゴリ": "製品A", "金額": 800000, "件数": 18 },
      { "カテゴリ": "製品B", "金額": 500000, "件数": 15 },
      { "カテゴリ": "サービス", "金額": 200000, "件数": 9 }
    ]
  }
}
EOF

# --- item-002: 週次アクセス集計 ---
cat > "${ITEMS_DIR}/item-002.json" << 'EOF'
{
  "id": "item-002",
  "title": "週次アクセス集計",
  "data": {
    "期間": "2026-W05",
    "PV合計": 8500,
    "UU": 1200,
    "直帰率": "35.2%",
    "ページ別": [
      { "ページ": "/top", "PV": 3000, "滞在秒": 120 },
      { "ページ": "/products", "PV": 2500, "滞在秒": 95 },
      { "ページ": "/about", "PV": 1800, "滞在秒": 60 },
      { "ページ": "/contact", "PV": 1200, "滞在秒": 45 }
    ]
  }
}
EOF

# --- item-003: 在庫ステータス ---
cat > "${ITEMS_DIR}/item-003.json" << 'EOF'
{
  "id": "item-003",
  "title": "在庫ステータス",
  "data": {
    "更新日": "2026-02-01",
    "全品目数": 350,
    "欠品数": 12,
    "適正率": "96.6%",
    "欠品一覧": [
      { "品目": "部品X-100", "必要数": 50, "入荷予定": "2026-02-10" },
      { "品目": "部品Y-200", "必要数": 30, "入荷予定": "2026-02-08" },
      { "品目": "部品Z-300", "必要数": 20, "入荷予定": "2026-02-15" }
    ]
  }
}
EOF

# --- item-004: 勤怠サマリー ---
cat > "${ITEMS_DIR}/item-004.json" << 'EOF'
{
  "id": "item-004",
  "title": "勤怠サマリー",
  "data": {
    "対象月": "2026年1月",
    "総従業員数": 85,
    "平均残業時間": 12.3,
    "有給取得率": "72.5%",
    "部門別": [
      { "部門": "開発部", "人数": 30, "平均残業": 15.2, "有給率": "68.0%" },
      { "部門": "営業部", "人数": 25, "平均残業": 10.5, "有給率": "75.0%" },
      { "部門": "管理部", "人数": 15, "平均残業": 8.1, "有給率": "80.0%" },
      { "部門": "製造部", "人数": 15, "平均残業": 14.0, "有給率": "65.0%" }
    ]
  }
}
EOF

# --- item-005: プロジェクト進捗 ---
cat > "${ITEMS_DIR}/item-005.json" << 'EOF'
{
  "id": "item-005",
  "title": "プロジェクト進捗",
  "data": {
    "報告日": "2026-02-05",
    "全プロジェクト数": 8,
    "完了数": 2,
    "進行中": 5,
    "遅延数": 1,
    "プロジェクト一覧": [
      { "名前": "基幹システム刷新", "進捗率": 85, "状態": "進行中" },
      { "名前": "モバイルアプリv2", "進捗率": 100, "状態": "完了" },
      { "名前": "データ分析基盤", "進捗率": 60, "状態": "進行中" },
      { "名前": "顧客ポータル", "進捗率": 30, "状態": "遅延" },
      { "名前": "社内Wiki移行", "進捗率": 100, "状態": "完了" }
    ]
  }
}
EOF

# --- item-006: 月次経費レポート ---
cat > "${ITEMS_DIR}/item-006.json" << 'EOF'
{
  "id": "item-006",
  "title": "月次経費レポート",
  "data": {
    "対象月": "2026年1月",
    "経費合計": 2850000,
    "予算消化率": "78.5%",
    "前月比": "-3.2%",
    "カテゴリ別": [
      { "カテゴリ": "人件費", "金額": 1500000, "比率": "52.6%" },
      { "カテゴリ": "設備費", "金額": 600000, "比率": "21.1%" },
      { "カテゴリ": "外注費", "金額": 450000, "比率": "15.8%" },
      { "カテゴリ": "交通費", "金額": 180000, "比率": "6.3%" },
      { "カテゴリ": "消耗品", "金額": 120000, "比率": "4.2%" }
    ]
  }
}
EOF

# --- item-007: 顧客満足度調査 ---
cat > "${ITEMS_DIR}/item-007.json" << 'EOF'
{
  "id": "item-007",
  "title": "顧客満足度調査",
  "data": {
    "調査期間": "2026年1月",
    "回答数": 256,
    "総合満足度": 4.2,
    "NPS": 45,
    "項目別": [
      { "項目": "製品品質", "スコア": 4.5, "前回比": "+0.2" },
      { "項目": "サポート対応", "スコア": 4.0, "前回比": "-0.1" },
      { "項目": "価格妥当性", "スコア": 3.8, "前回比": "+0.0" },
      { "項目": "納期遵守", "スコア": 4.3, "前回比": "+0.3" }
    ]
  }
}
EOF

# --- index.json ---
cat > "${DATA_DIR}/index.json" << EOF
{
  "items": [
    {
      "id": "item-001",
      "title": "月次売上レポート",
      "summary": { "期間": "2026年1月", "売上合計": 1500000, "件数": 42 }
    },
    {
      "id": "item-002",
      "title": "週次アクセス集計",
      "summary": { "期間": "2026-W05", "PV合計": 8500, "UU": 1200 }
    },
    {
      "id": "item-003",
      "title": "在庫ステータス",
      "summary": { "更新日": "2026-02-01", "全品目数": 350, "欠品数": 12 }
    },
    {
      "id": "item-004",
      "title": "勤怠サマリー",
      "summary": { "対象月": "2026年1月", "総従業員数": 85, "平均残業時間": 12.3 }
    },
    {
      "id": "item-005",
      "title": "プロジェクト進捗",
      "summary": { "報告日": "2026-02-05", "全プロジェクト数": 8, "遅延数": 1 }
    },
    {
      "id": "item-006",
      "title": "月次経費レポート",
      "summary": { "対象月": "2026年1月", "経費合計": 2850000, "予算消化率": "78.5%" }
    },
    {
      "id": "item-007",
      "title": "顧客満足度調査",
      "summary": { "調査期間": "2026年1月", "回答数": 256, "総合満足度": 4.2 }
    }
  ],
  "updatedAt": "${UPDATED_AT}"
}
EOF

echo ""
echo "=== ダミーデータ生成完了 ==="
echo "生成ファイル:"
echo "  - ${DATA_DIR}/index.json (7件のアイテム)"
for i in $(seq -w 1 7); do
  echo "  - ${ITEMS_DIR}/item-00${i}.json"
done
echo "updatedAt: ${UPDATED_AT}"
