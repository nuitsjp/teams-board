# リサーチ & 設計決定ログ

## サマリー
- **フィーチャー**: `remove-convert-local-data`
- **ディスカバリースコープ**: Simple Addition（コード削除のみ、新規コンポーネント追加なし）
- **主な発見事項**:
  - `src/local-batch/` の9モジュールは `scripts/convert-local-data.mjs` からのみ参照されており、他の機能への依存なし
  - `tests/integration/` ディレクトリには `local-conversion-pipeline.test.js` のみ存在し、ディレクトリごと削除可能
  - `docs/architecture.md` にはローカル変換フローの記述が複数箇所に分散（セクション1, 2.1, 3, 7.3, 8.3, 10, 12）

## リサーチログ

### local-batch モジュールの依存関係分析
- **コンテキスト**: `src/local-batch/` 配下のモジュールが他の機能に影響するか確認
- **調査方法**: `import.*local-batch` パターンでリポジトリ全体を検索
- **発見事項**:
  - `scripts/convert-local-data.mjs` のみが `local-batch` モジュールをインポートしている
  - テストファイル (`tests/local-batch/`, `tests/integration/`) がテスト対象としてインポートしている
  - フロントエンド SPA (`src/components/`, `src/pages/`, `src/services/`) からの参照なし
- **影響**: 安全に全削除可能。他機能への影響リスクはゼロ

### tests/integration ディレクトリの状態
- **コンテキスト**: 統合テストディレクトリの削除がテスト構成に影響するか確認
- **調査方法**: `tests/integration/*` をGlobで検索
- **発見事項**: `local-conversion-pipeline.test.js` のみ存在
- **影響**: ディレクトリごと削除可能。Vitest設定への影響なし（パターンマッチで自動検出のため）

### docs/architecture.md の参照箇所
- **コンテキスト**: ドキュメント更新の範囲を特定
- **調査方法**: `convert-local-data` および `data/sample` パターンで検索
- **発見事項**:
  - セクション1「目的と前提」: ローカル変換フローの説明
  - セクション2.1「稼働境界」: `src/local-batch/` の記述
  - セクション3「全体アーキテクチャ」: Mermaid図のローカル変換サブグラフ
  - セクション7.3「ローカル変換フロー」: シーケンス図
  - セクション8.3「運用支援スクリプト」: `convert-local-data.mjs` のリスト項目
  - セクション10「テスト構成」: `local-batch` テストの説明
  - セクション12「ディレクトリ要約」: `local-batch/`, `data/sample/`, `convert-local-data.mjs` の行
- **影響**: 6箇所以上の更新が必要

## 設計決定

### 決定: ドキュメント更新方式
- **コンテキスト**: `docs/architecture.md` から削除対象への参照を除去する方法
- **選択肢**:
  1. 参照行のみ削除（最小変更）
  2. セクション構成を見直してローカル変換関連セクションごと削除
- **選択**: 選択肢2 — ローカル変換フロー（セクション7.3）を完全削除し、他のセクションからは該当行を除去
- **理由**: セクション7.3は独立したフローであり、行単位の削除だけでは中途半端なセクションが残る
- **トレードオフ**: ドキュメント差分が大きくなるが、整合性が高い

### 決定: tests/integration ディレクトリの扱い
- **コンテキスト**: 唯一の統合テストが削除対象
- **選択**: ディレクトリごと削除
- **理由**: 空ディレクトリを残す必要なし。将来の統合テスト追加時に再作成すればよい

## リスク & 軽減策
- **リスク1**: 他のスペックドキュメントに `local-batch` への言及が残る → 軽減: スペックドキュメントはコードではないため、参照が残っても動作に影響しない。要件7.3で「スペックドキュメントを除く」と定義済み
- **リスク2**: `data/sample/` ディレクトリに `.gitkeep` 等が存在する可能性 → 軽減: Glob調査でCSVファイルのみ確認済み。ディレクトリごと削除可能
