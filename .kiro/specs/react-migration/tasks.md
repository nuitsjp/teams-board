# Implementation Plan

- [x] 1. Vite + Reactプロジェクトの初期セットアップ
- [x] 1.1 Reactプロジェクトの依存パッケージをインストールし、Viteビルド設定を作成する
  - React 19、ReactDOM 19、react-router-dom 7.xを本番依存パッケージとしてインストールする
  - @vitejs/plugin-reactを開発依存パッケージとしてインストールする
  - papaparseをnpm依存パッケージとして追加する（既存のimportmap/静的ファイル配置を置換）
  - Vite設定ファイルを作成し、Reactプラグインを有効化する
  - ビルド出力先を既存のデプロイスクリプトと互換性のあるディレクトリに設定する
  - 開発サーバー（dev）とプロダクションビルド（build）のnpmスクリプトを追加する
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 8.1, 8.4_

- [x] 1.2 Reactアプリケーションのエントリーポイントとルートコンポーネントを作成する
  - JSXのエントリーポイントを作成し、ReactDOMでルートにマウントする
  - HTMLエントリーポイントを作成し、既存のCSSスタイルシートを読み込む
  - Vite開発サーバーを起動して初期画面が表示されることを確認する
  - _Requirements: 1.1, 1.4, 6.1_

- [x] 2. ビジネスロジック層の移行（既存コード再利用）
- [x] 2.1 既存のサービスモジュールをReactプロジェクトのソースディレクトリにコピーする
  - DataFetcher（index.json取得、セッション詳細取得、キャッシュバスター制御）をコピーする
  - BlobWriter（Azure Blob PUT操作、リトライ機能）をコピーする
  - IndexMerger（DashboardIndexマージ、重複セッション検出）をコピーする
  - CsvTransformer（Teams CSV→JSON変換、UTF-16LE対応）をコピーする
  - papaparseのimportパスをnpmパッケージ参照に変更する（importmap依存を解消）
  - 共有ユーティリティ関数（formatDuration: 秒数→「X時間Y分」変換）を既存コードから抽出する
  - _Requirements: 5.1, 5.2, 5.3, 5.4, 1.5_

- [x] 3. 認証機能のReact Hook化
- [x] 3.1 SASトークン認証をカスタムHookとContext Providerで実装する
  - URLクエリパラメータからSASトークンを抽出し、管理者モードを判定するカスタムHookを作成する
  - セキュリティのため、トークン抽出後にURLからパラメータを削除する（history.replaceState）
  - 認証状態（sasToken, isAdmin）をコンポーネントツリー全体で共有するContext Providerを作成する
  - sasTokenが非nullの場合、isAdminが必ずtrueとなる不変条件を維持する
  - _Requirements: 4.1, 4.2, 4.3, 4.4_

- [x] 4. ルーティング設定
- [x] 4.1 ハッシュベースルーティングを設定し、全画面のルート定義を行う
  - createHashRouterでルート定義を作成する（ダッシュボード: "/"、メンバー詳細: "/members/:memberId"）
  - キャッチオールルート（"*"）を設定し、未定義のルートをダッシュボードにリダイレクトする
  - 認証コンテキストの値に基づいて、管理者パネルの表示/非表示を切り替える
  - ルートコンポーネント（App）にAuthContext ProviderとRouterProviderを組み込む
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5, 4.2_

- [x] 5. 閲覧系ページコンポーネントの実装
- [x] 5.1 (P) ダッシュボード画面を実装する
  - DataFetcherからindex.jsonを取得し、勉強会グループ一覧を表示する
  - メンバー一覧を合計参加時間の降順でソートして表示する
  - メンバーカードのクリックで詳細画面への遷移を実装する
  - データ読み込み中はローディング表示、取得失敗時はエラーメッセージを表示する
  - 既存のCSSクラス名（study-group-card, member-card等）を使用して既存デザインを維持する
  - _Requirements: 2.1, 2.5, 5.1, 5.5, 5.6, 6.1_

- [x] 5.2 (P) メンバー詳細画面を実装する
  - URLパラメータからメンバーIDを取得し、index.jsonから該当メンバーの情報を検索する
  - 該当メンバーのセッション詳細をPromise.allで並列取得する
  - 勉強会グループ名をルックアップし、出席記録を日付降順でソート表示する
  - 「一覧へ戻る」リンクでダッシュボード画面に遷移する機能を実装する
  - データ読み込み中はローディング表示、メンバー未検出時はエラーメッセージを表示する
  - _Requirements: 2.2, 2.5, 5.1, 5.5, 5.6, 6.1_

- [x] 6. 管理者機能の実装
- [x] 6.1 ファイルキュー状態管理のカスタムHookを実装する
  - useReducerでファイルキューの状態遷移を管理する（pending→validating→ready/error/duplicate_warning→saving→saved/save_failed）
  - ファイル追加時のバリデーション（拡張子チェック、サイズチェック）を実装する
  - CsvTransformerによる非同期パースを実行し、パース結果をキューアイテムに格納する
  - 既存セッションIDとの重複検出機能を実装する
  - 重複承認、ファイル削除、ステータス更新のアクションを提供する
  - _Requirements: 2.4_

- [x] 6.2 ファイル投入用のドラッグ&ドロップコンポーネントを実装する
  - ドラッグ&ドロップによるCSVファイル受付とファイル選択ダイアログの両方をサポートする
  - ドラッグオーバー時のビジュアルフィードバック（dragoverクラス）を実装する
  - 保存処理中は投入を無効化する
  - 既存のCSSクラス（csv-drop-zone）を使用する
  - _Requirements: 2.3, 6.2_

- [x] 6.3 ファイルキュー一覧とプレビューコンポーネントを実装する
  - キュー内の各ファイルをステータスアイコン・ファイル名・操作ボタンとともに一覧表示する
  - 各ステータス（pending, validating, ready, error, duplicate_warning, saving, saved, save_failed）に応じた表示を実装する
  - 削除ボタンと重複承認ボタンを提供する
  - パース完了アイテムのサマリーカード（グループ名、日付、参加者数、合計時間）を表示する
  - サマリーカードのクリックで詳細テーブル（参加者名、参加時間）を展開/折畳する
  - _Requirements: 2.3, 2.4_

- [x] 6.4 一括保存機能とプログレスバーを実装する
  - 「一括保存」ボタンでready状態の全ファイルに対してBlob書き込みシーケンスを実行する
  - 各ファイルの保存進捗をプログレスバーで表示する
  - 保存成功/失敗のステータスをキューに反映する
  - 失敗したファイルのリトライ機能を実装する
  - IndexMergerによるindex.jsonのマージを保存シーケンスに組み込む
  - _Requirements: 2.3, 5.2, 5.3, 6.3_

- [x] 7. 管理者パネルをルーティングに統合する
- [x] 7.1 管理者ページをAppコンポーネントに組み込み、認証状態に基づいて表示を制御する
  - 管理者モードが有効な場合にのみ管理者パネルを画面に表示する
  - 管理者パネルの初期化時に既存セッションIDを取得して重複検出に使用する
  - 非管理者の場合は管理者パネルを完全に非表示にする
  - モバイル端末での管理者パネル表示がレスポンシブに対応していることを確認する
  - _Requirements: 3.4, 4.2, 4.3, 6.4_

- [x] 8. テスト環境の構築とユニットテスト
- [x] 8.1 Vitest設定を更新し、React Testing Libraryとwebcryptoポリフィルを導入する
  - React Testing Libraryとその依存パッケージ（@testing-library/react, @testing-library/jest-dom）をインストールする
  - Vitest設定にjsdom環境とセットアップファイルを追加する
  - セットアップファイルでNode.jsのwebcryptoをグローバルにポリフィルする（crypto.subtle対応）
  - React Testing Libraryの自動クリーンアップを設定する
  - _Requirements: 7.1, 7.2_

- [x] 8.2 (P) 既存ビジネスロジックのユニットテストを移行・動作確認する
  - CsvTransformerのテスト（UTF-16LEデコード、日付変換、時間パース、SHA-256 ID生成）を移行する
  - IndexMergerのテスト（マージロジック、重複検出、新規グループ/メンバー追加）を移行する
  - DataFetcherのテスト（JSON取得、エラーハンドリング）を移行する
  - BlobWriterのテスト（書き込みシーケンス、リトライ）を移行する
  - import パスを新しいディレクトリ構造に合わせて調整する
  - npm testで全テストが成功することを確認する
  - _Requirements: 7.3, 7.5_

- [x] 8.3 (P) 認証HookとファイルキューHookのユニットテストを作成する
  - useAuthフックのテスト：SASトークン抽出、管理者モード判定、URL書き換え、トークンなしの一般ユーザーモード
  - useFileQueueフックのテスト：ファイル追加、バリデーション、パース完了後の状態遷移、重複検出、削除、承認
  - formatDurationユーティリティのテスト：秒数→「X時間Y分」変換の各パターン
  - _Requirements: 7.1, 7.2_

- [x] 8.4 ページコンポーネントの統合テストを作成する
  - DashboardPageの統合テスト：データ取得→グループ・メンバー一覧描画→メンバーカードクリック遷移を検証する
  - MemberDetailPageの統合テスト：データ取得→セッション並列取得→出席記録表示→「戻る」リンクを検証する
  - AdminPageの統合テスト：ファイル投入→プレビュー表示→一括保存→結果表示を検証する
  - npm testで全テスト（ユニット + 統合）が成功することを確認する
  - _Requirements: 7.2, 7.4, 7.5_

- [x] 9. Playwright E2Eテストの構築
- [x] 9.1 Playwrightの設定とE2Eテスト基盤を構築する
  - @playwright/testパッケージをインストールし、Playwrightブラウザをセットアップする
  - Playwright設定ファイルを作成し、Vite開発サーバーの自動起動（webServer設定）を構成する
  - テスト失敗時のスクリーンショット保存とトレース記録を設定する
  - ヘッドレスモードでのCI実行に対応する設定を行う
  - E2Eテスト実行用のnpmスクリプト（開発用、CI用）を追加する
  - E2Eテスト用のテストデータ（ダミーのindex.jsonとsession JSON）を準備する
  - _Requirements: 9.1, 9.5, 9.6, 9.7_

- [x] 9.2 ダッシュボード閲覧と画面遷移のE2Eテストを作成する
  - ダッシュボード画面にアクセスし、勉強会グループ一覧とメンバー一覧が描画されることを検証する
  - メンバーカードをクリックして詳細画面に遷移し、セッション参加履歴が表示されることを検証する
  - 「一覧へ戻る」リンクでダッシュボード画面に戻れることを検証する
  - 存在しないルートにアクセスした場合にダッシュボードにリダイレクトされることを検証する
  - _Requirements: 9.2, 9.3_

- [x] 9.3 管理者フローのE2Eテストを作成する
  - SASトークン付きURLでアクセスし、管理者パネルが表示されることを検証する
  - CSVファイルをアップロードし、プレビューが正しく表示されることを検証する
  - トークンなしでアクセスした場合に管理者パネルが非表示であることを検証する
  - _Requirements: 9.4_

- [x] 10. デプロイ互換性の確保と旧コード削除
- [x] 10.1 ビルド成果物の出力を確認し、デプロイスクリプトとの互換性を確保する
  - プロダクションビルドを実行し、静的ファイル（HTML, JS, CSS）が正しく出力されることを確認する
  - 出力ファイルがAzure Blob Storageの$webコンテナに配置可能な構成であることを検証する
  - データディレクトリ（data/）配下のJSONファイル構造に変更がないことを確認する
  - デプロイスクリプトのソースパスを新しいビルド出力ディレクトリに調整する
  - サーバーサイドレンダリングなしで静的配信のみで動作することを確認する
  - _Requirements: 8.1, 8.2, 8.3, 8.4_

- [x] 10.2 旧Vanilla JSコードを削除し、最終動作確認を行う
  - 旧エントリーポイント（public/js/配下の全モジュール）を削除する
  - PapaParseの静的ファイル（public/lib/）とimportmap設定を削除する
  - 旧index.html（importmapとscript type="module"タグ）を削除する
  - Vite開発サーバーとプロダクションビルドの両方で全機能が正常に動作することを確認する
  - npm test（ユニット + 統合）とE2Eテストがすべて成功することを確認する
  - _Requirements: 1.1, 2.5, 7.5_
