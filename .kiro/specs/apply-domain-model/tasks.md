# Implementation Plan

- [x] 1. CsvTransformer を Teams出席レポート専用パーサーに全面書き換えする
- [x] 1.1 (P) UTF-16LE エンコーディングのバイナリデータを文字列に変換し、3セクション構成（要約・参加者・アクティビティ）に分割する機能を実装する
  - ファイルの ArrayBuffer を UTF-16LE として読み取り、文字列に変換する
  - 行単位で走査し「1. 要約」「2. 参加者」「3. 会議中の」をマーカーとしてセクション境界を検出する
  - セクションが見つからない場合はフォーマットエラーとして報告する
  - テスト: 正常な3セクション構成の分割、マーカー欠損時のエラー
  - _Requirements: 5.1, 5.6_

- [x] 1.2 (P) 「1. 要約」セクションから会議タイトルと開催日を抽出する機能を実装する
  - 要約セクションのキー・バリュー構造から「会議のタイトル」と「開始時刻」を取得する
  - 会議タイトルからTeamsの定型装飾（ダブルクォート囲み、「で会議中」等の接尾辞）を除去してクリーニング済み勉強会名を得る
  - 開始時刻の日付部分を YYYY-MM-DD 形式で抽出する
  - テスト: 様々な装飾パターンのクリーニング、日付抽出
  - _Requirements: 1.2, 5.3, 5.4_

- [x] 1.3 (P) 「会議の長さ」フィールドの時間表記を秒単位の数値に変換する機能を実装する
  - `X 分 Y 秒` 形式と `X 時間 Y 分 Z 秒` 形式の両方を正規表現でパースする
  - 時間・分・秒を秒数に統合して返す
  - パースできない形式は警告として記録しスキップする
  - テスト: 分秒形式、時分秒形式、不正形式のハンドリング
  - _Requirements: 1.6, 5.2_

- [x] 1.4 SHA-256 ハッシュによる各種 ID 生成機能を実装する
  - Web Crypto API を使用して文字列の SHA-256 ハッシュ先頭8桁（hex）を生成する
  - StudyGroup ID: クリーニング済み勉強会名からハッシュ生成
  - Session ID: StudyGroup ID と開催日（YYYY-MM-DD）をハイフンで結合して生成
  - Member ID: メールアドレスからハッシュ生成
  - テスト: 同一入力に対する一貫性、異なる入力に対する一意性
  - _Requirements: 1.3, 1.4, 1.5_

- [x] 1.5 「2. 参加者」セクションをTSVとしてパースし、全変換結果を統合する機能を実装する
  - 参加者セクションのテキストをタブ区切りでパースし、各行から参加者名・メールアドレス・会議の長さを抽出する
  - 参加者が0件の場合はエラーとして報告する
  - 上記1.1〜1.4の機能を統合し、File オブジェクトを受け取って SessionRecord と IndexMerger 用の入力データを生成する一連の変換パイプラインを構築する
  - パース成功時は勉強会情報と出席記録のセットを、失敗時はエラー情報を返す
  - テスト: 正常CSV→完全な変換結果、不正CSV→エラー、参加者0件エラー
  - _Requirements: 1.1, 5.1, 5.5, 5.6, 7.5_

- [x] 2. IndexMerger を新しいドメインモデルに対応させる
- [x] 2.1 (P) 新セッションの追加に伴い、勉強会グループと参加者のサマリ情報をマージ更新する機能を実装する
  - 既存の DashboardIndex に新セッションのデータをイミュータブルにマージする
  - 勉強会グループサマリ: 該当グループの合計学習時間を加算し、セッションIDを追加する（グループが存在しなければ新規作成）
  - 参加者サマリ: 該当メンバーの合計学習時間を加算し、セッションIDを追加する（メンバーが存在しなければ新規作成）
  - 重複セッションID検出時は警告を返し、上書きしない
  - 更新日時を記録する
  - 元のオブジェクトを変更しないことを保証する
  - テスト: 新規グループ追加、既存グループ更新、新規メンバー追加、既存メンバー更新、重複検出、イミュータブル性
  - _Requirements: 6.4_

- [x] 3. Router のルート定義を新しい画面構成に対応させる
- [x] 3.1 ハッシュルーティングをトップ画面と個人ドリルダウンの2画面構成に変更する
  - トップ画面（`#/`）と個人ドリルダウン画面（`#/members/<memberId>`）の2ルートを定義する
  - 旧ルート（`#/items/<itemId>`）を廃止する
  - ルート解析でビュー種別と該当メンバーIDを判定して返す
  - 画面遷移の発火と遷移先の通知を既存のリスナーパターンで処理する
  - テスト: 各ルートのパース、navigate、hashchange連動
  - _Requirements: 3.3, 4.4, 7.2_

- [x] 4. DataFetcher のデータ取得メソッドを新しいデータ構造に対応させる
- [x] 4.1 (P) index.json 取得とセッション単位の JSON 取得に対応する
  - トップ画面用にキャッシュバスター付きで index.json を取得する機能を維持・調整する
  - セッション詳細データを個別JSONファイルとして取得する機能を追加する（不変リソースのためキャッシュバスターなし）
  - 旧メソッド（アイテム詳細取得）をセッション取得に置換する
  - 取得成功時はデータを、失敗時はエラー情報を返す
  - テスト: 正常取得、エラーハンドリング
  - _Requirements: 2.1, 4.1, 6.1, 6.2, 7.3_

- [x] 5. DashboardView をドメインモデルに合わせて全面書き換えする
- [x] 5.1 トップ画面に勉強会グループ一覧と参加者一覧の2セクションを描画する
  - index.json から取得したデータを元に、勉強会グループごとの名称・開催回数・合計学習時間の一覧を描画する
  - 参加者ごとの名前・参加回数・合計学習時間の一覧を合計時間の降順で描画する
  - 秒数を人間が読みやすい時間形式（X時間Y分）に変換して表示する
  - データ取得中のローディング状態と、取得失敗時のエラーメッセージを表示する
  - 参加者をクリックした際に個人ドリルダウン画面へ遷移するナビゲーションを設定する
  - テスト: 2セクションの描画、降順ソート、時間フォーマット、ローディング、エラー表示、参加者クリック→ルーティング
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 3.1, 3.2, 3.3_

- [x] 6. MemberDetailView（個人ドリルダウン画面）を新規実装する
- [x] 6.1 選択された参加者の出席詳細一覧と合計情報を描画する
  - DashboardIndex の参加者サマリからセッションIDリストを取得し、対応するセッション詳細データを並列で取得する
  - 各セッションから該当メンバーの出席記録を抽出し、勉強会名・開催日・学習時間を開催日降順で一覧表示する
  - 一覧の上部または下部に合計学習時間と参加回数のサマリを表示する
  - 「戻る」操作でトップ画面に戻るナビゲーションを提供する
  - セッションデータの取得に失敗した場合はエラーメッセージを表示し、トップへの戻り手段を提供する
  - 勉強会名の解決には DashboardIndex の勉強会グループサマリを参照する
  - テスト: sessionIds並列取得、出席記録抽出、降順表示、合計表示、戻るリンク、エラーハンドリング
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5_

- [x] 7. AdminPanel を Teams出席レポートの変換・保存フローに対応させる
- [x] 7.1 CSV投入からプレビュー表示・保存確定までの管理者ワークフローを実装する
  - ファイル選択でTeams出席レポートCSVを受け付ける
  - CSV変換ロジックを呼び出し、成功時はセッション情報（勉強会名・開催日・参加者一覧）のプレビューを表示する
  - 変換エラー時はエラーメッセージを表示する
  - 保存確定時に以下の3ファイルを順に書き込む: 元CSV（raw）→ セッション詳細データ → DashboardIndex（最新取得→マージ→書き込み）
  - 書き込み結果の成功/失敗を表示する
  - テスト: ファイル投入→パース→プレビュー→保存の一連フロー、エラー表示
  - _Requirements: 5.5, 5.6, 6.3, 7.4_

- [x] 8. main.js のエントリポイントと全体結合を更新する
- [x] 8.1 アプリケーション起動時の初期化と画面遷移のワイヤリングを新しいドメインモデルに合わせて更新する
  - Router の新ルート定義に基づき、トップ画面と個人ドリルダウン画面の切り替えを設定する
  - DetailView から MemberDetailView への参照を更新する
  - DataFetcher の新しいメソッドを各ビューコンポーネントに接続する
  - 管理者パネルに CsvTransformer・IndexMerger・BlobWriter を接続する
  - 統合テスト: 閲覧フロー（index取得→トップ描画→参加者選択→ドリルダウン→戻る）、管理者フロー（CSV投入→プレビュー→保存→2ファイル書き込み確認）
  - _Requirements: 7.1, 7.2, 7.3, 7.4, 7.5, 7.6_

## Requirements Coverage

| Requirement | Task(s) |
|---|---|
| 1.1 | 1.5 |
| 1.2 | 1.2 |
| 1.3 | 1.4 |
| 1.4 | 1.4 |
| 1.5 | 1.4 |
| 1.6 | 1.3 |
| 2.1 | 4.1, 5.1 |
| 2.2 | 5.1 |
| 2.3 | 5.1 |
| 2.4 | 5.1 |
| 3.1 | 5.1 |
| 3.2 | 5.1 |
| 3.3 | 3.1, 5.1 |
| 4.1 | 4.1, 6.1 |
| 4.2 | 6.1 |
| 4.3 | 6.1 |
| 4.4 | 3.1, 6.1 |
| 4.5 | 6.1 |
| 5.1 | 1.1, 1.5 |
| 5.2 | 1.3 |
| 5.3 | 1.2 |
| 5.4 | 1.2 |
| 5.5 | 1.5, 7.1 |
| 5.6 | 1.1, 1.5, 7.1 |
| 6.1 | 4.1, 5.1 |
| 6.2 | 4.1 |
| 6.3 | 7.1 |
| 6.4 | 2.1 |
| 7.1 | 8.1 |
| 7.2 | 3.1, 8.1 |
| 7.3 | 4.1, 8.1 |
| 7.4 | 7.1, 8.1 |
| 7.5 | 1.5, 8.1 |
| 7.6 | 8.1 |
